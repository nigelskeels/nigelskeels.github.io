<!DOCTYPE html>
<html>
<head>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width">
  <title>Native recorder</title>
</head>

<body>
  

  <button id="record">record</button>
  <button id="stop">stop</button>
 

    <script>
  
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    navigator.getUserMedia = ( navigator.getUserMedia ||
                       navigator.webkitGetUserMedia ||
                       navigator.mozGetUserMedia ||
                       navigator.msGetUserMedia);

    var context = new AudioContext();
    
    var record = document.querySelector('#record');
    var stop = document.querySelector('#stop');
   
    
    if (navigator.getUserMedia) {
        console.log('getUserMedia supported.');

        var constraints = { audio: true };
        var chunks = [];

        var onSuccess = function(stream) {
            var mediaRecorder = new MediaRecorder(stream);

            record.onclick = function() {
              mediaRecorder.start();
              console.log(mediaRecorder.state);
              console.log("recorder started");
              record.style.background = "red";
              stop.disabled = false;
              record.disabled = true;
            }

            stop.onclick = function() {
              mediaRecorder.stop();
              console.log(mediaRecorder.state);
              console.log("recorder stopped");
              record.style.background = "";
              record.style.color = "";

              stop.disabled = true;
              record.disabled = false;
            }

            mediaRecorder.onstop = function(e) {
              console.log("onstop() called.",e);
              
               var blob = new Blob(chunks, { 'type' : 'audio/wav' });
               chunks = [];

               var reader = new FileReader();
               reader.addEventListener("loadend", function() {
                  context.decodeAudioData(reader.result, function(buffer) {
                    playsound(buffer); 
                  }, 
                  function(e){console.log("error ",e)});
              });
              reader.readAsArrayBuffer(blob);
            }

            mediaRecorder.ondataavailable = function(e) {
              chunks.push(e.data);
            }
          }

          var onError = function(err) {
            console.log('The following error occured: ' + err);
          }

          navigator.getUserMedia(constraints, onSuccess, onError);


    } else {
       console.log('getUserMedia not supported on your browser!');
    }


    function playsound(thisbuffer){
          var source = context.createBufferSource();
          source.buffer = thisbuffer;                    
          source.connect(context.destination);       
          source.start(0);                   
    }


</script>
</body>